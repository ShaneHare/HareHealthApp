<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Hare Health</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0E1014; --surface:#161A20; --surface2:#1C2028; --border:#252A33;
  --accent:#1E88E5; --adim:rgba(30,136,229,0.12);
  --green:#2ECC71; --gdim:rgba(46,204,113,0.12);
  --red:#E53935; --orange:#FF9800; --purple:#AB47BC;
  --text:#F0F2F5; --text2:#8B919C; --text3:#555C68;
  --mono:'DM Mono',monospace; --sans:'Syne',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:var(--sans);}
.screen{display:none;}
.screen.active{display:flex;flex-direction:column;}

/* AUTH */
#login,#register{min-height:100vh;align-items:center;justify-content:center;padding:40px 24px;}
.auth-card{width:100%;max-width:400px;}
.logo-row{display:flex;align-items:center;gap:12px;margin-bottom:36px;}
.logo-name{font-size:17px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;}
.auth-headline{font-size:28px;font-weight:800;letter-spacing:-0.02em;line-height:1.1;margin-bottom:6px;}
.auth-tagline{font-family:var(--mono);font-size:11px;letter-spacing:0.18em;color:var(--text3);text-transform:uppercase;margin-bottom:20px;}
.demo-box{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px 16px;margin-bottom:28px;}
.demo-lbl{font-family:var(--mono);font-size:9px;letter-spacing:0.2em;text-transform:uppercase;color:var(--text3);margin-bottom:8px;}
.demo-row{display:flex;justify-content:space-between;align-items:center;gap:12px;}
.demo-creds{display:flex;flex-direction:column;gap:4px;}
.demo-cred{font-family:var(--mono);font-size:12px;color:var(--text);}
.demo-cred span{color:var(--text3);font-size:9px;letter-spacing:0.14em;text-transform:uppercase;margin-right:8px;}
.use-demo-btn{flex-shrink:0;background:var(--adim);border:1px solid rgba(30,136,229,0.3);color:var(--accent);font-family:var(--mono);font-size:10px;letter-spacing:0.12em;text-transform:uppercase;padding:8px 14px;border-radius:4px;cursor:pointer;}
.use-demo-btn:active{opacity:0.7;}
.field-group{display:flex;flex-direction:column;gap:14px;margin-bottom:24px;}
.field label{display:block;font-family:var(--mono);font-size:10px;letter-spacing:0.2em;text-transform:uppercase;color:var(--text3);margin-bottom:7px;}
.field input{display:block;width:100%;background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:14px 16px;color:var(--text);font-family:var(--mono);font-size:15px;outline:none;-webkit-appearance:none;appearance:none;}
.field input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(30,136,229,0.12);}
.field input::placeholder{color:var(--text3);}
.form-err{font-family:var(--mono);font-size:11px;color:var(--red);padding:10px 14px;background:rgba(229,57,53,0.08);border:1px solid rgba(229,57,53,0.2);border-radius:6px;margin-bottom:14px;text-align:center;}
.btn-primary{display:block;width:100%;background:var(--accent);color:#fff;border:none;border-radius:6px;padding:15px;font-family:var(--sans);font-size:14px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;cursor:pointer;margin-bottom:10px;}
.btn-primary:active{background:#1565C0;}
.btn-secondary{display:block;width:100%;background:transparent;color:var(--text2);border:1px solid var(--border);border-radius:6px;padding:14px;font-family:var(--sans);font-size:13px;font-weight:500;letter-spacing:0.06em;text-transform:uppercase;cursor:pointer;}
.btn-secondary:active{background:var(--surface2);}
.auth-footer{margin-top:32px;display:flex;align-items:center;gap:14px;justify-content:center;}
.sec-badge{display:flex;align-items:center;gap:5px;font-family:var(--mono);font-size:10px;letter-spacing:0.14em;text-transform:uppercase;color:var(--text3);}
.sec-dot{width:5px;height:5px;border-radius:50%;background:var(--green);}
.dot-sep{width:3px;height:3px;border-radius:50%;background:var(--border);}
.remembered{display:flex;align-items:center;justify-content:space-between;margin-top:8px;padding:0 2px;}
.remembered-lbl{font-family:var(--mono);font-size:10px;color:var(--green);letter-spacing:0.08em;}
.forget-btn{background:none;border:none;font-family:var(--mono);font-size:10px;color:var(--text3);cursor:pointer;text-decoration:underline;}

/* TOP BAR */
.top-bar{display:flex;align-items:center;justify-content:space-between;padding:18px 24px 14px;border-bottom:1px solid var(--border);}
.top-logo{display:flex;align-items:center;gap:8px;}
.top-name{font-size:13px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--text2);}
.top-right{display:flex;align-items:center;gap:8px;}
.icon-btn{width:32px;height:32px;border-radius:6px;background:transparent;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;}
.icon-btn:active{background:var(--surface2);}
.avatar{width:32px;height:32px;border-radius:50%;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:11px;color:var(--text2);cursor:pointer;}

/* STATUS */
.status-section{padding:22px 24px 0;}
.greeting-lbl{font-family:var(--mono);font-size:11px;letter-spacing:0.18em;text-transform:uppercase;color:var(--text3);margin-bottom:5px;}
.status-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;}
.status-headline{font-size:24px;font-weight:800;letter-spacing:-0.02em;}
.status-badge{display:flex;align-items:center;gap:7px;background:var(--gdim);border:1px solid rgba(46,204,113,0.2);border-radius:20px;padding:5px 12px;}
.status-badge.elevated{background:rgba(255,152,0,0.12);border-color:rgba(255,152,0,0.25);}
.status-badge.elevated .s-dot,.status-badge.elevated .s-lbl{background:var(--orange);color:var(--orange);}
.status-badge.alert{background:rgba(229,57,53,0.12);border-color:rgba(229,57,53,0.25);}
.status-badge.alert .s-dot{background:var(--red);}
.status-badge.alert .s-lbl{color:var(--red);}
.s-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2.5s ease-in-out infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}
.s-lbl{font-family:var(--mono);font-size:11px;letter-spacing:0.12em;text-transform:uppercase;color:var(--green);}
.status-sub{font-family:var(--mono);font-size:11px;color:var(--text3);letter-spacing:0.04em;}
.ecg-line{width:100%;height:34px;margin:14px 0 0;opacity:0.3;}

/* LOG BUTTON */
.log-btn{margin:16px 24px 0;padding:14px 18px;background:var(--accent);border-radius:10px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;}
.log-btn:active{background:#1565C0;}
.log-left{display:flex;align-items:center;gap:14px;}
.log-icon{width:34px;height:34px;background:rgba(255,255,255,0.15);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.log-title{font-size:14px;font-weight:700;color:#fff;margin-bottom:2px;}
.log-sub{font-family:var(--mono);font-size:10px;color:rgba(255,255,255,0.6);letter-spacing:0.1em;text-transform:uppercase;}
.log-arrow{font-family:var(--mono);font-size:18px;color:rgba(255,255,255,0.7);}

/* METRICS */
.metrics-section{padding:18px 24px 0;}
.sec-label{font-family:var(--mono);font-size:10px;letter-spacing:0.22em;text-transform:uppercase;color:var(--text3);margin-bottom:12px;}
.metrics-grid{display:flex;flex-direction:column;gap:10px;}
.metric-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 18px;display:flex;align-items:flex-start;justify-content:space-between;cursor:pointer;}
.metric-card:active{background:var(--surface2);}
.metric-card.s-optimal{border-left:3px solid var(--green);}
.metric-card.s-elevated{border-left:3px solid var(--orange);}
.metric-card.s-high{border-left:3px solid var(--red);}
.metric-card.s-low{border-left:3px solid var(--purple);}
.rbadge{display:inline-flex;align-items:center;gap:4px;font-family:var(--mono);font-size:9px;letter-spacing:0.14em;text-transform:uppercase;padding:3px 7px;border-radius:4px;margin-bottom:4px;}
.rb-optimal{background:var(--gdim);color:var(--green);border:1px solid rgba(46,204,113,0.25);}
.rb-elevated{background:rgba(255,152,0,0.12);color:var(--orange);border:1px solid rgba(255,152,0,0.25);}
.rb-high{background:rgba(229,57,53,0.12);color:var(--red);border:1px solid rgba(229,57,53,0.25);}
.rb-low{background:rgba(171,71,188,0.12);color:var(--purple);border:1px solid rgba(171,71,188,0.25);}
.metric-val{font-family:var(--mono);font-size:28px;font-weight:500;letter-spacing:-0.03em;line-height:1;margin-bottom:4px;word-break:break-all;}
.metric-name{font-family:var(--mono);font-size:10px;letter-spacing:0.18em;text-transform:uppercase;color:var(--text3);}
.metric-right{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0;}
.sparkline{height:24px;width:70px;}
.trend-lbl{font-family:var(--mono);font-size:11px;}
.trend-up{color:var(--accent);} .trend-dn{color:var(--green);} .trend-st{color:var(--text3);}
.avg-lbl{font-family:var(--mono);font-size:10px;color:var(--text3);text-align:right;}

/* BMI */
.bmi-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 18px;cursor:pointer;margin-top:10px;}
.bmi-card:active{background:var(--surface2);}
.bmi-card.s-optimal{border-left:3px solid var(--green);}
.bmi-card.s-elevated{border-left:3px solid var(--orange);}
.bmi-card.s-high{border-left:3px solid var(--red);}
.bmi-card.s-low{border-left:3px solid var(--purple);}
.bmi-val-row{display:flex;align-items:baseline;gap:6px;margin:4px 0;}
.bmi-num{font-family:var(--mono);font-size:28px;font-weight:500;letter-spacing:-0.03em;}
.bmi-unit{font-family:var(--mono);font-size:12px;color:var(--text3);}
.bmi-name{font-family:var(--mono);font-size:10px;letter-spacing:0.18em;text-transform:uppercase;color:var(--text3);}
.bmi-bar-wrap{margin:12px 0 6px;position:relative;}
.bmi-track{height:6px;border-radius:3px;background:linear-gradient(to right,#AB47BC 0%,#AB47BC 11.5%,#2ECC71 11.5%,#2ECC71 40%,#FF9800 40%,#FF9800 56.25%,#E53935 56.25%,#E53935 100%);}
.bmi-marker{position:absolute;top:-4px;width:4px;height:14px;background:#fff;border-radius:2px;transform:translateX(-50%);box-shadow:0 0 4px rgba(0,0,0,0.5);transition:left 0.4s;}
.bmi-bar-labels{display:flex;justify-content:space-between;margin-top:5px;}
.bmi-bar-lbl{font-family:var(--mono);font-size:9px;color:var(--text3);}
.bmi-note{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:6px;}
.bmi-source{font-family:var(--mono);font-size:9px;color:var(--text3);margin-top:6px;}
.bmi-nodata{font-family:var(--mono);font-size:11px;color:var(--text3);padding:4px 0;}

/* NAV CARDS */
.nav-section{padding:18px 24px;}
.nav-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.nav-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 10px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;}
.nav-card:active{background:var(--surface2);}
.nav-lbl{font-family:var(--mono);font-size:10px;letter-spacing:0.14em;text-transform:uppercase;color:var(--text2);text-align:center;}

/* BOTTOM NAV */
.bnav{border-top:1px solid var(--border);padding:10px 24px;padding-bottom:max(16px,env(safe-area-inset-bottom,16px));display:flex;justify-content:space-around;position:sticky;bottom:0;background:var(--bg);z-index:10;}
.bnav-item{display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;opacity:0.4;padding:4px 12px;}
.bnav-item.active{opacity:1;}
.bnav-lbl{font-family:var(--mono);font-size:9px;letter-spacing:0.14em;text-transform:uppercase;color:var(--text2);}

/* SCREEN HEADER */
.screen-hdr{display:flex;align-items:center;gap:14px;padding:18px 24px 14px;border-bottom:1px solid var(--border);}
.back-btn{width:32px;height:32px;border-radius:6px;background:transparent;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;}
.screen-title{font-size:17px;font-weight:700;letter-spacing:-0.01em;}

/* HISTORY */
.history-list{padding:18px 24px;display:flex;flex-direction:column;gap:10px;overflow-y:auto;}
.hist-empty{padding:50px 24px;text-align:center;}
.hist-empty-icon{font-size:28px;margin-bottom:10px;opacity:0.3;}
.hist-empty-txt{font-family:var(--mono);font-size:11px;color:var(--text3);letter-spacing:0.1em;line-height:1.8;}
.hist-item{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 18px;}
.hist-date{font-family:var(--mono);font-size:10px;color:var(--text3);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:10px;}
.hist-vals{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.hist-val-lbl{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3px;}
.hist-val-num{font-family:var(--mono);font-size:16px;font-weight:500;}
.hist-val-unit{font-family:var(--mono);font-size:10px;color:var(--text3);}

/* TRENDS */
.trends-body{padding:18px 24px;display:flex;flex-direction:column;gap:18px;overflow-y:auto;}
.trend-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:18px;}
.trend-card-hdr{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px;}
.trend-card-title{font-family:var(--mono);font-size:10px;letter-spacing:0.2em;text-transform:uppercase;color:var(--text3);margin-bottom:4px;}
.trend-card-val{font-family:var(--mono);font-size:24px;font-weight:500;}
.trend-chg{font-family:var(--mono);font-size:11px;padding:4px 8px;border-radius:4px;}
.tc-up{background:var(--adim);color:var(--accent);}
.tc-dn{background:var(--gdim);color:var(--green);}
.tc-flat{background:var(--surface2);color:var(--text3);}
.chart-svg{width:100%;height:80px;}
.chart-labels{display:flex;justify-content:space-between;margin-top:5px;}
.chart-lbl{font-family:var(--mono);font-size:9px;color:var(--text3);}

/* PROFILE */
.profile-body{padding:18px 24px;display:flex;flex-direction:column;gap:14px;overflow-y:auto;}
.prof-avatar-row{display:flex;align-items:center;gap:14px;padding:18px;background:var(--surface);border:1px solid var(--border);border-radius:10px;}
.prof-avatar-big{width:52px;height:52px;border-radius:50%;background:var(--adim);border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:17px;color:var(--accent);flex-shrink:0;}
.prof-name{font-size:17px;font-weight:700;margin-bottom:2px;}
.prof-user{font-family:var(--mono);font-size:11px;color:var(--text3);}
.settings-group-lbl{font-family:var(--mono);font-size:10px;letter-spacing:0.2em;text-transform:uppercase;color:var(--text3);margin-bottom:6px;padding:0 4px;}
.settings-group{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--border);cursor:pointer;}
.settings-row:last-child{border-bottom:none;}
.settings-row:active{background:var(--surface2);}
.s-row-left{display:flex;align-items:center;gap:12px;}
.s-row-icon{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.s-row-lbl{font-size:14px;font-weight:600;}
.s-row-sub{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:1px;}
.s-row-right{font-family:var(--mono);font-size:11px;color:var(--text3);}
.toggle{width:38px;height:21px;border-radius:11px;background:var(--border);position:relative;cursor:pointer;transition:background 0.2s;flex-shrink:0;}
.toggle.on{background:var(--accent);}
.toggle-knob{position:absolute;top:2.5px;left:2.5px;width:16px;height:16px;border-radius:50%;background:#fff;transition:transform 0.2s;}
.toggle.on .toggle-knob{transform:translateX(17px);}
.logout-btn{display:block;width:100%;background:rgba(229,57,53,0.08);color:var(--red);border:1px solid rgba(229,57,53,0.2);border-radius:6px;padding:14px;font-family:var(--sans);font-size:14px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;cursor:pointer;}
.logout-btn:active{background:rgba(229,57,53,0.18);}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:200;align-items:flex-end;justify-content:center;}
.modal-overlay.open{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px 16px 0 0;padding:24px 22px 40px;width:100%;max-width:480px;}
.modal-handle{width:34px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 22px;}
.modal-title{font-size:17px;font-weight:700;margin-bottom:3px;}
.modal-sub{font-family:var(--mono);font-size:10px;letter-spacing:0.16em;text-transform:uppercase;color:var(--text3);margin-bottom:22px;}
.modal-fields{display:flex;flex-direction:column;gap:14px;margin-bottom:22px;}
.modal-field label{display:block;font-family:var(--mono);font-size:10px;letter-spacing:0.2em;text-transform:uppercase;color:var(--text3);margin-bottom:7px;}
.modal-field input{display:block;width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:13px 15px;color:var(--text);font-family:var(--mono);font-size:22px;font-weight:500;outline:none;-webkit-appearance:none;appearance:none;}
.modal-field input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(30,136,229,0.12);}
.modal-field input::placeholder{color:var(--text3);font-size:16px;}
.modal-hint{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:4px;}
.bp-row{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;}
.bp-sep{font-family:var(--mono);font-size:22px;color:var(--text3);text-align:center;padding-top:22px;}
.modal-actions{display:flex;gap:10px;}
.modal-actions .btn-primary{flex:1;margin-bottom:0;}
.modal-actions .btn-secondary{flex:0 0 auto;width:auto;padding:13px 18px;margin-bottom:0;}

/* TOAST */
.toast{display:none;position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:var(--green);color:#000;font-family:var(--mono);font-size:11px;font-weight:500;letter-spacing:0.14em;text-transform:uppercase;padding:9px 18px;border-radius:20px;z-index:300;white-space:nowrap;}

/* DEMO SWITCHER */
.demo-switcher{position:fixed;top:14px;right:14px;display:flex;gap:5px;z-index:50;}
.dsw-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text3);font-family:var(--mono);font-size:9px;letter-spacing:0.1em;text-transform:uppercase;padding:5px 10px;border-radius:4px;cursor:pointer;}
.dsw-btn.active{border-color:var(--accent);color:var(--accent);background:var(--adim);}

/* MOBILE */
@media(max-width:390px){
  #login,#register{padding:28px 16px;}
  .status-section,.metrics-section,.nav-section,.history-list,.trends-body,.profile-body{padding-left:16px;padding-right:16px;}
  .log-btn{margin-left:16px;margin-right:16px;}
  .top-bar,.screen-hdr{padding-left:16px;padding-right:16px;}
}
@media(max-width:360px){
  .bnav-lbl{font-size:8px;}
  .bnav-item{padding:4px 8px;}
  .bmi-bar-lbl:nth-child(2),.bmi-bar-lbl:nth-child(3){display:none;}
}

/* PRINT */
.print-hdr{display:none;}
@media print{
  .demo-switcher,.bnav,.log-btn,.nav-section,.modal-overlay,.toast,
  .top-bar .icon-btn,.back-btn,#register,#history,#trends,#profile,#login{display:none!important;}
  #home{display:block!important;background:#fff!important;color:#000!important;}
  body{background:#fff!important;}
  .print-hdr{display:block!important;margin-bottom:16pt;}
  .metric-card,.bmi-card{background:#fff!important;border:1px solid #ccc!important;border-left-width:3px!important;break-inside:avoid;margin-bottom:8pt;}
  .bmi-track{-webkit-print-color-adjust:exact;print-color-adjust:exact;}
  @page{margin:18mm 14mm;size:A4 portrait;}
  body::after{content:"Hare Health · Generated " attr(data-print-date) " · Screening tool only";display:block;font-size:8pt;color:#999;text-align:center;margin-top:16pt;border-top:1px solid #eee;padding-top:6pt;}
}
</style>
</head>
<body>

<!-- Demo Switcher -->
<div class="demo-switcher">
  <button class="dsw-btn active" onclick="showScreen('login')">Login</button>
  <button class="dsw-btn" onclick="showScreen('home')">Dashboard</button>
</div>

<!-- ══════════════════════════════════════
     LOGIN
══════════════════════════════════════ -->
<div id="login" class="screen active">
  <div class="auth-card">
    <div class="logo-row">
      <svg width="32" height="32" viewBox="0 0 36 36" fill="none">
        <rect x="6" y="6" width="4" height="24" rx="1.5" fill="#1E88E5"/>
        <rect x="26" y="6" width="4" height="24" rx="1.5" fill="#1E88E5"/>
        <polyline points="10,18 14,18 16,12 18,24 20,14 22,18 26,18" stroke="#1E88E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
      <span class="logo-name">Hare Health</span>
    </div>
    <h1 class="auth-headline">Cardiovascular<br>Intelligence.</h1>
    <p class="auth-tagline">Measure. Monitor. Improve.</p>

    <div class="demo-box">
      <div class="demo-lbl">Demo Credentials</div>
      <div class="demo-row">
        <div class="demo-creds">
          <div class="demo-cred"><span>User</span>tester1</div>
          <div class="demo-cred"><span>Pass</span>Perform2024!</div>
        </div>
        <button class="use-demo-btn" onclick="fillDemo()">Use Demo</button>
      </div>
    </div>

    <div id="login-form-err"></div>
    <div class="field-group">
      <div class="field">
        <label for="f-username">Username</label>
        <input id="f-username" type="text" placeholder="tester1" autocomplete="username" autocorrect="off" autocapitalize="none" spellcheck="false">
      </div>
      <div class="field">
        <label for="f-password">Password</label>
        <input id="f-password" type="password" placeholder="••••••••••" autocomplete="current-password">
      </div>
    </div>
    <button class="btn-primary" onclick="doLogin()">Log In</button>
    <button class="btn-secondary" onclick="showScreen('register')">Create Account</button>
    <div id="login-remembered"></div>
    <div class="auth-footer">
      <div class="sec-badge"><span class="sec-dot"></span>Encrypted</div>
      <div class="dot-sep"></div>
      <div class="sec-badge">Private</div>
      <div class="dot-sep"></div>
      <div class="sec-badge">Secure</div>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════
     REGISTER
══════════════════════════════════════ -->
<div id="register" class="screen">
  <div class="auth-card">
    <div class="logo-row">
      <svg width="32" height="32" viewBox="0 0 36 36" fill="none">
        <rect x="6" y="6" width="4" height="24" rx="1.5" fill="#1E88E5"/>
        <rect x="26" y="6" width="4" height="24" rx="1.5" fill="#1E88E5"/>
        <polyline points="10,18 14,18 16,12 18,24 20,14 22,18 26,18" stroke="#1E88E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
      <span class="logo-name">Hare Health</span>
    </div>
    <h1 class="auth-headline">Create Your<br>Account.</h1>
    <p class="auth-tagline">Performance starts with a baseline.</p>
    <div id="reg-form-err"></div>
    <div class="field-group">
      <div class="field">
        <label for="r-name">Full Name</label>
        <input id="r-name" type="text" placeholder="James Mitchell" autocomplete="name">
      </div>
      <div class="field">
        <label for="r-user">Username</label>
        <input id="r-user" type="text" placeholder="Choose a username" autocomplete="username" autocorrect="off" autocapitalize="none">
      </div>
      <div class="field">
        <label for="r-pass">Password</label>
        <input id="r-pass" type="password" placeholder="Min 8 characters" autocomplete="new-password">
      </div>
      <div class="field">
        <label for="r-conf">Confirm Password</label>
        <input id="r-conf" type="password" placeholder="Re-enter password" autocomplete="new-password">
      </div>
    </div>
    <button class="btn-primary" onclick="doRegister()">Create Account</button>
    <button class="btn-secondary" onclick="showScreen('login')">Back to Login</button>
    <div class="auth-footer">
      <div class="sec-badge"><span class="sec-dot"></span>Encrypted</div>
      <div class="dot-sep"></div>
      <div class="sec-badge">Private</div>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════
     HOME / DASHBOARD
══════════════════════════════════════ -->
<div id="home" class="screen">
  <div class="print-hdr">
    <div style="display:flex;align-items:center;margin-bottom:12pt;padding-bottom:8pt;border-bottom:2px solid #1E88E5;">
      <strong style="font-size:14pt;letter-spacing:0.06em;color:#1E88E5;">HARE HEALTH</strong>
      <span style="font-size:8pt;color:#666;margin-left:auto;" id="print-date-el"></span>
    </div>
    <div style="font-size:11pt;font-weight:700;" id="print-name-el"></div>
    <div style="font-size:8pt;color:#666;margin-bottom:12pt;">Cardiovascular Performance Report</div>
  </div>
  <div class="top-bar">
    <div class="top-logo">
      <svg width="18" height="18" viewBox="0 0 36 36" fill="none">
        <rect x="6" y="6" width="4" height="24" rx="1.5" fill="#1E88E5"/>
        <rect x="26" y="6" width="4" height="24" rx="1.5" fill="#1E88E5"/>
        <polyline points="10,18 14,18 16,12 18,24 20,14 22,18 26,18" stroke="#1E88E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
      <span class="top-name">Hare Health</span>
    </div>
    <div class="top-right">
      <div class="icon-btn" onclick="exportPDF()" title="Export PDF" style="border-color:rgba(30,136,229,0.3);">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#1E88E5" stroke-width="2" stroke-linecap="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      </div>
      <div class="avatar" id="home-avatar" onclick="showScreen('profile')">HH</div>
    </div>
  </div>
  <div class="status-section">
    <p class="greeting-lbl" id="home-date">—</p>
    <div class="status-row">
      <h2 class="status-headline" id="home-greeting">Good Morning</h2>
      <div class="status-badge" id="status-badge">
        <span class="s-dot"></span>
        <span class="s-lbl" id="s-lbl">Stable</span>
      </div>
    </div>
    <p class="status-sub" id="home-sub">Log a reading to get started</p>
    <svg class="ecg-line" viewBox="0 0 380 34" preserveAspectRatio="none">
      <polyline points="0,18 30,18 38,18 42,5 46,31 50,18 60,18 90,18 98,18 102,5 106,31 110,18 120,18 150,18 158,18 162,5 166,31 170,18 180,18 210,18 218,18 222,5 226,31 230,18 240,18 270,18 278,18 282,5 286,31 290,18 300,18 380,18"
        fill="none" stroke="#1E88E5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>

  <div class="log-btn" onclick="openLogModal()">
    <div class="log-left">
      <div class="log-icon">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </div>
      <div>
        <div class="log-title">Log Today's Reading</div>
        <div class="log-sub">Heart rate · Blood pressure · Weight</div>
      </div>
    </div>
    <span class="log-arrow">→</span>
  </div>

  <div class="metrics-section">
    <p class="sec-label">Core Vitals</p>
    <div class="metrics-grid">

      <div class="metric-card" id="card-hr" onclick="showScreen('trends')">
        <div>
          <div id="rbadge-hr"></div>
          <div class="metric-val" id="val-hr">— <span style="font-size:13px;color:var(--text3)">bpm</span></div>
          <div class="metric-name">Heart Rate</div>
        </div>
        <div class="metric-right">
          <svg class="sparkline" id="spark-hr" viewBox="0 0 70 24" fill="none"></svg>
          <div class="trend-lbl trend-st" id="trend-hr">—</div>
          <div class="avg-lbl" id="avg-hr">No data</div>
        </div>
      </div>

      <div class="metric-card" id="card-bp" onclick="showScreen('trends')">
        <div>
          <div id="rbadge-bp"></div>
          <div class="metric-val" id="val-bp">—/— <span style="font-size:13px;color:var(--text3)">mmHg</span></div>
          <div class="metric-name">Blood Pressure</div>
        </div>
        <div class="metric-right">
          <svg class="sparkline" id="spark-bp" viewBox="0 0 70 24" fill="none"></svg>
          <div class="trend-lbl trend-st" id="trend-bp">—</div>
          <div class="avg-lbl" id="avg-bp">No data</div>
        </div>
      </div>

      <div class="metric-card" id="card-wt" onclick="showScreen('trends')">
        <div>
          <div id="rbadge-wt"></div>
          <div class="metric-val" id="val-wt">— <span style="font-size:13px;color:var(--text3)">lbs</span></div>
          <div class="metric-name">Body Weight</div>
        </div>
        <div class="metric-right">
          <svg class="sparkline" id="spark-wt" viewBox="0 0 70 24" fill="none"></svg>
          <div class="trend-lbl trend-st" id="trend-wt">—</div>
          <div class="avg-lbl" id="avg-wt">No data</div>
        </div>
      </div>

      <div class="bmi-card" id="card-bmi" onclick="showScreen('trends')">
        <div id="rbadge-bmi"></div>
        <div class="bmi-val-row">
          <span class="bmi-num" id="bmi-num">—</span>
          <span class="bmi-unit">kg/m²</span>
        </div>
        <div class="bmi-name">Body Mass Index</div>
        <div id="bmi-detail"><div class="bmi-nodata">Set height in Profile to calculate BMI</div></div>
        <div class="bmi-source" id="bmi-source"></div>
      </div>

    </div>
  </div>

  <div class="nav-section">
    <p class="sec-label">Navigate</p>
    <div class="nav-grid">
      <div class="nav-card" onclick="showScreen('history')">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1E88E5" stroke-width="1.5" stroke-linecap="round"><polyline points="2,12 5,12 7,6 9,18 11,10 13,14 15,12 17,12 22,12"/></svg>
        <span class="nav-lbl">History</span>
      </div>
      <div class="nav-card" onclick="showScreen('trends')">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1E88E5" stroke-width="1.5" stroke-linecap="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        <span class="nav-lbl">Trends</span>
      </div>
      <div class="nav-card" onclick="showScreen('profile')">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1E88E5" stroke-width="1.5" stroke-linecap="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        <span class="nav-lbl">Profile</span>
      </div>
    </div>
  </div>

  <div class="bnav">
    <div class="bnav-item active" onclick="showScreen('home')">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#F0F2F5" stroke-width="1.5" stroke-linecap="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
      <span class="bnav-lbl">Home</span>
    </div>
    <div class="bnav-item" onclick="showScreen('history')">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg>
      <span class="bnav-lbl">History</span>
    </div>
    <div class="bnav-item" onclick="showScreen('trends')">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      <span class="bnav-lbl">Trends</span>
    </div>
    <div class="bnav-item" onclick="showScreen('profile')">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
      <span class="bnav-lbl">Profile</span>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════
     HISTORY
══════════════════════════════════════ -->
<div id="history" class="screen">
  <div class="screen-hdr">
    <div class="back-btn" onclick="showScreen('home')">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="2" stroke-linecap="round"><polyline points="15,18 9,12 15,6"/></svg>
    </div>
    <span class="screen-title">Reading History</span>
  </div>
  <div class="history-list" id="history-list"></div>
  <div class="bnav">
    <div class="bnav-item" onclick="showScreen('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span class="bnav-lbl">Home</span></div>
    <div class="bnav-item active" onclick="showScreen('history')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#F0F2F5" stroke-width="1.5" stroke-linecap="round"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg><span class="bnav-lbl">History</span></div>
    <div class="bnav-item" onclick="showScreen('trends')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span class="bnav-lbl">Trends</span></div>
    <div class="bnav-item" onclick="showScreen('profile')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg><span class="bnav-lbl">Profile</span></div>
  </div>
</div>

<!-- ══════════════════════════════════════
     TRENDS
══════════════════════════════════════ -->
<div id="trends" class="screen">
  <div class="screen-hdr">
    <div class="back-btn" onclick="showScreen('home')">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="2" stroke-linecap="round"><polyline points="15,18 9,12 15,6"/></svg>
    </div>
    <span class="screen-title">Trends</span>
  </div>
  <div class="trends-body">
    <div class="trend-card">
      <div class="trend-card-hdr">
        <div><div class="trend-card-title">Heart Rate</div><div class="trend-card-val" id="tv-hr">— bpm</div></div>
        <div class="trend-chg tc-flat" id="tc-hr">No data</div>
      </div>
      <svg class="chart-svg" id="ch-hr" viewBox="0 0 300 80" preserveAspectRatio="none"></svg>
      <div class="chart-labels" id="cl-hr"></div>
    </div>
    <div class="trend-card">
      <div class="trend-card-hdr">
        <div><div class="trend-card-title">Blood Pressure (Systolic)</div><div class="trend-card-val" id="tv-bp">—/— mmHg</div></div>
        <div class="trend-chg tc-flat" id="tc-bp">No data</div>
      </div>
      <svg class="chart-svg" id="ch-bp" viewBox="0 0 300 80" preserveAspectRatio="none"></svg>
      <div class="chart-labels" id="cl-bp"></div>
    </div>
    <div class="trend-card">
      <div class="trend-card-hdr">
        <div><div class="trend-card-title">Body Weight</div><div class="trend-card-val" id="tv-wt">— lbs</div></div>
        <div class="trend-chg tc-flat" id="tc-wt">No data</div>
      </div>
      <svg class="chart-svg" id="ch-wt" viewBox="0 0 300 80" preserveAspectRatio="none"></svg>
      <div class="chart-labels" id="cl-wt"></div>
    </div>
  </div>
  <div class="bnav">
    <div class="bnav-item" onclick="showScreen('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span class="bnav-lbl">Home</span></div>
    <div class="bnav-item" onclick="showScreen('history')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg><span class="bnav-lbl">History</span></div>
    <div class="bnav-item active" onclick="showScreen('trends')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#F0F2F5" stroke-width="1.5" stroke-linecap="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span class="bnav-lbl">Trends</span></div>
    <div class="bnav-item" onclick="showScreen('profile')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg><span class="bnav-lbl">Profile</span></div>
  </div>
</div>

<!-- ══════════════════════════════════════
     PROFILE
══════════════════════════════════════ -->
<div id="profile" class="screen">
  <div class="screen-hdr">
    <div class="back-btn" onclick="showScreen('home')">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="2" stroke-linecap="round"><polyline points="15,18 9,12 15,6"/></svg>
    </div>
    <span class="screen-title">Profile &amp; Settings</span>
  </div>
  <div class="profile-body">
    <div class="prof-avatar-row">
      <div class="prof-avatar-big" id="prof-avatar-big">HH</div>
      <div>
        <div class="prof-name" id="prof-name-el">Your Name</div>
        <div class="prof-user" id="prof-user-el">—</div>
      </div>
    </div>
    <div>
      <p class="settings-group-lbl">Personal Info</p>
      <div class="settings-group">
        <div class="settings-row" onclick="editField('name')">
          <div class="s-row-left">
            <div class="s-row-icon" style="background:var(--adim)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1E88E5" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg></div>
            <div><div class="s-row-lbl">Full Name</div><div class="s-row-sub" id="disp-name">Not set</div></div>
          </div>
          <div class="s-row-right">Edit →</div>
        </div>
        <div class="settings-row" onclick="editField('age')">
          <div class="s-row-left">
            <div class="s-row-icon" style="background:var(--adim)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1E88E5" stroke-width="2" stroke-linecap="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></div>
            <div><div class="s-row-lbl">Age</div><div class="s-row-sub" id="disp-age">Not set</div></div>
          </div>
          <div class="s-row-right">Edit →</div>
        </div>
        <div class="settings-row" onclick="editField('height')">
          <div class="s-row-left">
            <div class="s-row-icon" style="background:var(--adim)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1E88E5" stroke-width="2" stroke-linecap="round"><line x1="12" y1="2" x2="12" y2="22"/><path d="M8 6l4-4 4 4"/><path d="M8 18l4 4 4-4"/></svg></div>
            <div><div class="s-row-lbl">Height</div><div class="s-row-sub" id="disp-height">Not set</div></div>
          </div>
          <div class="s-row-right">Edit →</div>
        </div>
      </div>
    </div>
    <div>
      <p class="settings-group-lbl">Preferences</p>
      <div class="settings-group">
        <div class="settings-row">
          <div class="s-row-left">
            <div class="s-row-icon" style="background:var(--gdim)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#2ECC71" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg></div>
            <div><div class="s-row-lbl">Daily Reminders</div><div class="s-row-sub">Remind me to log readings</div></div>
          </div>
          <div class="toggle" id="tog-reminders" onclick="togglePref('reminders')"><div class="toggle-knob"></div></div>
        </div>
      </div>
    </div>
    <div>
      <p class="settings-group-lbl">Data</p>
      <div class="settings-group">
        <div class="settings-row" onclick="showScreen('history')">
          <div class="s-row-left">
            <div class="s-row-icon" style="background:var(--surface2)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="2" stroke-linecap="round"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg></div>
            <div><div class="s-row-lbl">Reading History</div><div class="s-row-sub" id="disp-count">0 readings</div></div>
          </div>
          <div class="s-row-right">View →</div>
        </div>
        <div class="settings-row" onclick="clearData()">
          <div class="s-row-left">
            <div class="s-row-icon" style="background:rgba(229,57,53,0.08)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#E53935" stroke-width="2" stroke-linecap="round"><polyline points="3,6 5,6 21,6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/></svg></div>
            <div><div class="s-row-lbl" style="color:var(--red)">Clear All Data</div><div class="s-row-sub">Permanently delete readings</div></div>
          </div>
          <div class="s-row-right" style="color:var(--red)">Delete</div>
        </div>
      </div>
    </div>
    <button class="logout-btn" onclick="doLogout()">Sign Out</button>
  </div>
  <div class="bnav">
    <div class="bnav-item" onclick="showScreen('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span class="bnav-lbl">Home</span></div>
    <div class="bnav-item" onclick="showScreen('history')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg><span class="bnav-lbl">History</span></div>
    <div class="bnav-item" onclick="showScreen('trends')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#8B919C" stroke-width="1.5" stroke-linecap="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><span class="bnav-lbl">Trends</span></div>
    <div class="bnav-item active" onclick="showScreen('profile')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#F0F2F5" stroke-width="1.5" stroke-linecap="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg><span class="bnav-lbl">Profile</span></div>
  </div>
</div>

<!-- LOG MODAL -->
<div class="modal-overlay" id="log-modal" onclick="bgClose(event,'log-modal')">
  <div class="modal">
    <div class="modal-handle"></div>
    <p class="modal-title">Log Reading</p>
    <p class="modal-sub" id="log-modal-date">Today</p>
    <div class="modal-fields">
      <div class="modal-field">
        <label for="in-hr">Heart Rate</label>
        <input id="in-hr" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="72" min="30" max="220">
        <p class="modal-hint">bpm — resting</p>
      </div>
      <div class="modal-field">
        <label>Blood Pressure</label>
        <div class="bp-row">
          <div>
            <input id="in-sys" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="118" min="60" max="250">
            <p class="modal-hint">systolic</p>
          </div>
          <div class="bp-sep">/</div>
          <div>
            <input id="in-dia" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="76" min="40" max="150">
            <p class="modal-hint">diastolic</p>
          </div>
        </div>
      </div>
      <div class="modal-field">
        <label for="in-wt">Weight (lbs)</label>
        <input id="in-wt" type="number" inputmode="decimal" pattern="[0-9.]*" placeholder="185.0" min="50" max="700" step="0.1">
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('log-modal')">Cancel</button>
      <button class="btn-primary" onclick="saveReading()">Save Reading</button>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="edit-modal" onclick="bgClose(event,'edit-modal')">
  <div class="modal">
    <div class="modal-handle"></div>
    <p class="modal-title" id="edit-title">Edit</p>
    <p class="modal-sub" id="edit-sub">Update your info</p>
    <div class="modal-fields">
      <div class="modal-field">
        <label id="edit-lbl">Value</label>
        <input id="edit-input" type="text" style="font-size:18px;">
        <p class="modal-hint" id="edit-hint"></p>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('edit-modal')">Cancel</button>
      <button class="btn-primary" onclick="saveEdit()">Save</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ─────────────────────────────────────
// STORAGE
// ─────────────────────────────────────
var KEYS = { users:'hh2_users', readings:'hh2_readings', prefs:'hh2_prefs', session:'hh2_session', lastuser:'hh2_lastuser' };

function ls_set(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} }
function ls_get(k,def){ try{ var v=localStorage.getItem(k); return v!==null ? JSON.parse(v) : def; }catch(e){ return def; } }

// ─────────────────────────────────────
// USERS
// ─────────────────────────────────────
function getUsers(){
  var u = ls_get(KEYS.users, []);
  if(!u.length){
    u = [{ username:'tester1', password:'Perform2024!', name:'James Mitchell' }];
    ls_set(KEYS.users, u);
  }
  return u;
}

var currentUser = null;

// ─────────────────────────────────────
// SESSION
// ─────────────────────────────────────
function getSession(){ return ls_get(KEYS.session, null); }
function setSession(u){ ls_set(KEYS.session, u); }
function clearSession(){ ls_set(KEYS.session, null); }

// ─────────────────────────────────────
// READINGS
// ─────────────────────────────────────
function getReadings(){ return ls_get(KEYS.readings, []); }
function saveReadings(r){ ls_set(KEYS.readings, r); }

// ─────────────────────────────────────
// PREFS
// ─────────────────────────────────────
function getPrefs(){ return ls_get(KEYS.prefs, { name:'', age:'', height:'', reminders:false }); }
function savePrefs(p){ ls_set(KEYS.prefs, p); }

// ─────────────────────────────────────
// SCREEN NAVIGATION
// ─────────────────────────────────────
function showScreen(id){
  var screens = document.querySelectorAll('.screen');
  for(var i=0; i<screens.length; i++) screens[i].classList.remove('active');
  document.getElementById(id).classList.add('active');

  // demo switcher highlight
  var btns = document.querySelectorAll('.dsw-btn');
  for(var j=0; j<btns.length; j++) btns[j].classList.remove('active');
  var map = { login:'Login', home:'Dashboard' };
  for(var k=0; k<btns.length; k++){
    if(btns[k].textContent === map[id]) btns[k].classList.add('active');
  }

  if(id === 'login')   initLogin();
  if(id === 'home')    refreshHome();
  if(id === 'history') refreshHistory();
  if(id === 'trends')  refreshTrends();
  if(id === 'profile') refreshProfile();
}

// ─────────────────────────────────────
// LOGIN SCREEN INIT
// ─────────────────────────────────────
function initLogin(){
  var lastUser = ls_get(KEYS.lastuser, '');
  var uEl = document.getElementById('f-username');
  var remRow = document.getElementById('login-remembered');
  var errEl = document.getElementById('login-form-err');
  if(errEl) errEl.innerHTML = '';
  if(uEl) uEl.style.borderColor = '';
  var pEl = document.getElementById('f-password');
  if(pEl){ pEl.value = ''; pEl.style.borderColor = ''; }

  if(lastUser && uEl){
    uEl.value = lastUser;
    if(remRow) remRow.innerHTML = '<div class="remembered"><span class="remembered-lbl">&#9679; Session remembered</span><button class="forget-btn" onclick="forgetUser()">Forget</button></div>';
    setTimeout(function(){ if(pEl) pEl.focus(); }, 60);
  } else {
    if(uEl) uEl.value = '';
    if(remRow) remRow.innerHTML = '';
  }
}

function forgetUser(){
  ls_set(KEYS.lastuser, '');
  var uEl = document.getElementById('f-username');
  var remRow = document.getElementById('login-remembered');
  if(uEl){ uEl.value = ''; uEl.focus(); }
  if(remRow) remRow.innerHTML = '';
}

// ─────────────────────────────────────
// AUTH ACTIONS
// ─────────────────────────────────────
function fillDemo(){
  var uEl = document.getElementById('f-username');
  var pEl = document.getElementById('f-password');
  var eEl = document.getElementById('login-form-err');
  if(uEl) uEl.value = 'tester1';
  if(pEl) pEl.value = 'Perform2024!';
  if(eEl) eEl.innerHTML = '';
  if(uEl) uEl.style.borderColor = '';
  if(pEl){ pEl.style.borderColor = ''; pEl.focus(); }
}

function doLogin(){
  var uEl = document.getElementById('f-username');
  var pEl = document.getElementById('f-password');
  var eEl = document.getElementById('login-form-err');

  if(!uEl || !pEl) return;

  var username = uEl.value.trim();
  var password = pEl.value;

  if(eEl) eEl.innerHTML = '';
  uEl.style.borderColor = '';
  pEl.style.borderColor = '';

  if(!username){
    uEl.style.borderColor = '#E53935';
    uEl.focus();
    return;
  }
  if(!password){
    pEl.style.borderColor = '#E53935';
    pEl.focus();
    return;
  }

  var users = getUsers();
  var match = null;
  for(var i=0; i<users.length; i++){
    if(users[i].username === username && users[i].password === password){
      match = users[i];
      break;
    }
  }

  if(!match){
    if(eEl) eEl.innerHTML = '<p class="form-err">Invalid username or password</p>';
    pEl.value = '';
    pEl.focus();
    return;
  }

  currentUser = match;
  ls_set(KEYS.lastuser, username);
  setSession(username);

  var prefs = getPrefs();
  if(!prefs.name && match.name){ prefs.name = match.name; savePrefs(prefs); }

  showScreen('home');
}

function doRegister(){
  var nameEl = document.getElementById('r-name');
  var userEl = document.getElementById('r-user');
  var passEl = document.getElementById('r-pass');
  var confEl = document.getElementById('r-conf');
  var errEl  = document.getElementById('reg-form-err');

  var name = nameEl.value.trim();
  var user = userEl.value.trim();
  var pass = passEl.value;
  var conf = confEl.value;

  if(errEl) errEl.innerHTML = '';

  if(!name){ nameEl.focus(); return; }
  if(!user || user.length < 3){
    if(errEl) errEl.innerHTML = '<p class="form-err">Username must be at least 3 characters</p>';
    userEl.focus(); return;
  }
  if(!pass || pass.length < 8){
    if(errEl) errEl.innerHTML = '<p class="form-err">Password must be at least 8 characters</p>';
    passEl.focus(); return;
  }
  if(pass !== conf){
    if(errEl) errEl.innerHTML = '<p class="form-err">Passwords do not match</p>';
    confEl.focus(); return;
  }

  var users = getUsers();
  for(var i=0; i<users.length; i++){
    if(users[i].username === user){
      if(errEl) errEl.innerHTML = '<p class="form-err">Username already taken</p>';
      userEl.focus(); return;
    }
  }

  var newUser = { username:user, password:pass, name:name };
  users.push(newUser);
  ls_set(KEYS.users, users);

  currentUser = newUser;
  ls_set(KEYS.lastuser, user);
  setSession(user);

  var prefs = getPrefs();
  prefs.name = name;
  savePrefs(prefs);

  showScreen('home');
}

function doLogout(){
  clearSession();
  currentUser = null;
  showScreen('login');
}

// ─────────────────────────────────────
// HOME
// ─────────────────────────────────────
function refreshHome(){
  var prefs    = getPrefs();
  var readings = getReadings();
  var now      = new Date();
  var h        = now.getHours();
  var days     = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  var months   = ['January','February','March','April','May','June','July','August','September','October','November','December'];

  document.getElementById('home-date').textContent = days[now.getDay()] + ', ' + months[now.getMonth()] + ' ' + now.getDate();
  document.getElementById('home-greeting').textContent = h < 12 ? 'Good Morning' : h < 17 ? 'Good Afternoon' : 'Good Evening';

  var initials = 'HH';
  if(prefs.name){
    var pts = prefs.name.split(' ');
    initials = pts.map(function(p){ return p[0]||''; }).join('').slice(0,2).toUpperCase();
  }
  document.getElementById('home-avatar').textContent = initials;

  if(!readings.length){
    document.getElementById('val-hr').innerHTML = '— <span style="font-size:13px;color:var(--text3)">bpm</span>';
    document.getElementById('val-bp').innerHTML = '—/— <span style="font-size:13px;color:var(--text3)">mmHg</span>';
    document.getElementById('val-wt').innerHTML = '— <span style="font-size:13px;color:var(--text3)">lbs</span>';
    ['avg-hr','avg-bp','avg-wt'].forEach(function(id){ document.getElementById(id).textContent = 'No data'; });
    ['trend-hr','trend-bp','trend-wt'].forEach(function(id){ document.getElementById(id).textContent = '—'; });
    ['rbadge-hr','rbadge-bp','rbadge-wt','rbadge-bmi'].forEach(function(id){ document.getElementById(id).innerHTML = ''; });
    ['card-hr','card-bp','card-wt'].forEach(function(id){ document.getElementById(id).className = 'metric-card'; });
    document.getElementById('card-bmi').className = 'bmi-card';
    document.getElementById('home-sub').textContent = 'Log a reading to get started';
    document.getElementById('status-badge').className = 'status-badge';
    document.getElementById('s-lbl').textContent = 'Stable';
    refreshBMI(null, prefs);
    return;
  }

  var last = readings[readings.length - 1];
  if(last.hr)  document.getElementById('val-hr').innerHTML = last.hr + ' <span style="font-size:13px;color:var(--text3)">bpm</span>';
  if(last.sys) document.getElementById('val-bp').innerHTML = last.sys + '/' + (last.dia||'—') + ' <span style="font-size:13px;color:var(--text3)">mmHg</span>';
  if(last.wt)  document.getElementById('val-wt').innerHTML = parseFloat(last.wt).toFixed(1) + ' <span style="font-size:13px;color:var(--text3)">lbs</span>';

  var ld = new Date(last.ts);
  document.getElementById('home-sub').textContent = 'Last: ' + ld.toLocaleDateString() + ' at ' + ld.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

  // 7-day averages
  var recent = readings.slice(-7);
  function avg(arr, key){
    var vals = arr.filter(function(r){ return r[key]; }).map(function(r){ return parseFloat(r[key]); });
    if(!vals.length) return null;
    return (vals.reduce(function(a,b){ return a+b; }, 0) / vals.length).toFixed(1);
  }
  var aHR = avg(recent, 'hr'), aSYS = avg(recent, 'sys'), aWT = avg(recent, 'wt');
  if(aHR)  document.getElementById('avg-hr').textContent = '7d avg: ' + aHR + ' bpm';
  if(aSYS) document.getElementById('avg-bp').textContent = '7d avg: ' + aSYS + ' sys';
  if(aWT)  document.getElementById('avg-wt').textContent = '7d avg: ' + aWT + ' lbs';

  // Trend arrows
  function setTrend(arr, key, elId){
    var vals = arr.filter(function(r){ return r[key]; }).map(function(r){ return parseFloat(r[key]); });
    if(vals.length < 2) return;
    var diff = vals[vals.length-1] - vals[0];
    var el = document.getElementById(elId);
    if(Math.abs(diff) < 0.5){ el.textContent = '→ Stable'; el.className = 'trend-lbl trend-st'; }
    else if(diff > 0){ el.textContent = '↑ +' + Math.abs(diff).toFixed(1); el.className = 'trend-lbl trend-up'; }
    else { el.textContent = '↓ -' + Math.abs(diff).toFixed(1); el.className = 'trend-lbl trend-dn'; }
  }
  setTrend(recent, 'hr', 'trend-hr');
  setTrend(recent, 'sys', 'trend-bp');
  setTrend(recent, 'wt', 'trend-wt');

  // Sparklines
  function drawSpark(svgId, data, key, color){
    var el = document.getElementById(svgId);
    el.innerHTML = '';
    var vals = data.slice(-8).filter(function(r){ return r[key]; }).map(function(r){ return parseFloat(r[key]); });
    if(vals.length < 2) return;
    var mn = Math.min.apply(null,vals), mx = Math.max.apply(null,vals), rng = mx - mn || 1;
    var pts = vals.map(function(v,i){
      return ((i/(vals.length-1))*68+1) + ',' + ((22 - ((v-mn)/rng)*20) + 1);
    }).join(' ');
    var pl = document.createElementNS('http://www.w3.org/2000/svg','polyline');
    pl.setAttribute('points', pts);
    pl.setAttribute('fill','none');
    pl.setAttribute('stroke', color);
    pl.setAttribute('stroke-width','1.5');
    pl.setAttribute('stroke-linecap','round');
    el.appendChild(pl);
  }
  drawSpark('spark-hr', readings, 'hr',  '#1E88E5');
  drawSpark('spark-bp', readings, 'sys', '#1E88E5');
  drawSpark('spark-wt', readings, 'wt',  '#2ECC71');

  // Range badges
  function setRangeBadge(badgeId, cardId, cardClass, status, dot, label){
    var badge = document.getElementById(badgeId);
    var card  = document.getElementById(cardId);
    card.className = cardClass;
    if(!status){ badge.innerHTML = ''; return; }
    card.classList.add('s-' + status);
    badge.innerHTML = '<span class="rbadge rb-'+status+'">'+dot+' '+label+'</span>';
  }

  if(last.hr){
    var hr = parseFloat(last.hr);
    if(hr < 50)        setRangeBadge('rbadge-hr','card-hr','metric-card','low','▼','Low (Bradycardia)');
    else if(hr <= 90)  setRangeBadge('rbadge-hr','card-hr','metric-card','optimal','●','Optimal');
    else if(hr <= 100) setRangeBadge('rbadge-hr','card-hr','metric-card','elevated','▲','Elevated');
    else               setRangeBadge('rbadge-hr','card-hr','metric-card','high','▲','High (Tachycardia)');
  }

  if(last.sys){
    var sys = parseFloat(last.sys);
    if(sys < 90)        setRangeBadge('rbadge-bp','card-bp','metric-card','low','▼','Low (Hypotension)');
    else if(sys <= 120) setRangeBadge('rbadge-bp','card-bp','metric-card','optimal','●','Optimal');
    else if(sys <= 129) setRangeBadge('rbadge-bp','card-bp','metric-card','elevated','▲','Elevated');
    else if(sys <= 139) setRangeBadge('rbadge-bp','card-bp','metric-card','high','▲','High Stage 1');
    else                setRangeBadge('rbadge-bp','card-bp','metric-card','high','▲','High Stage 2');
  }

  document.getElementById('rbadge-wt').innerHTML = '';
  document.getElementById('card-wt').className = 'metric-card';

  // Overall status badge
  var hrCard = document.getElementById('card-hr');
  var bpCard = document.getElementById('card-bp');
  var badge  = document.getElementById('status-badge');
  var lbl    = document.getElementById('s-lbl');
  badge.className = 'status-badge';
  if(hrCard.classList.contains('s-high') || bpCard.classList.contains('s-high')){
    badge.classList.add('alert'); lbl.textContent = 'Alert'; lbl.style.color = 'var(--red)';
  } else if(hrCard.classList.contains('s-elevated') || bpCard.classList.contains('s-elevated') ||
            hrCard.classList.contains('s-low')      || bpCard.classList.contains('s-low')){
    badge.classList.add('elevated'); lbl.textContent = 'Elevated'; lbl.style.color = 'var(--orange)';
  } else {
    lbl.textContent = 'Stable'; lbl.style.color = 'var(--green)';
  }

  refreshBMI(last, prefs);
}

function refreshBMI(last, prefs){
  var card    = document.getElementById('card-bmi');
  var numEl   = document.getElementById('bmi-num');
  var detail  = document.getElementById('bmi-detail');
  var sourceEl= document.getElementById('bmi-source');
  var badgeEl = document.getElementById('rbadge-bmi');
  card.className = 'bmi-card';
  badgeEl.innerHTML = '';
  sourceEl.textContent = '';

  if(!last || !last.wt){
    numEl.textContent = '—';
    detail.innerHTML = '<div class="bmi-nodata">Log your weight to calculate BMI</div>';
    return;
  }

  function parseHeightToInches(s){
    if(!s) return null;
    s = s.toString().trim().toLowerCase().replace(/\s/g,'');
    var cmMatch = s.match(/([0-9.]+)cm/);
    if(cmMatch) return parseFloat(cmMatch[1]) / 2.54;
    var mMatch = s.match(/^([0-9.]+)m$/);
    if(mMatch) return parseFloat(mMatch[1]) * 39.3701;
    var ftIn = s.match(/([0-9]+)['\u2019]([0-9]+)/);
    if(ftIn) return parseInt(ftIn[1])*12 + parseInt(ftIn[2]);
    var justIn = parseFloat(s);
    if(!isNaN(justIn) && justIn >= 48 && justIn <= 96) return justIn;
    return null;
  }

  var hIn = parseHeightToInches(prefs.height);
  if(!hIn){
    numEl.textContent = '—';
    detail.innerHTML = '<div class="bmi-nodata">Set height in Profile → Personal Info</div>';
    return;
  }

  var wt  = parseFloat(last.wt);
  var bmi = Math.round((wt * 703) / (hIn * hIn) * 10) / 10;
  numEl.textContent = bmi.toFixed(1);

  var status, label;
  if(bmi < 18.5)      { status='low';      label='Underweight'; }
  else if(bmi < 25)   { status='optimal';  label='Healthy Weight'; }
  else if(bmi < 30)   { status='elevated'; label='Overweight'; }
  else if(bmi < 35)   { status='high';     label='Obese (Class I)'; }
  else if(bmi < 40)   { status='high';     label='Obese (Class II)'; }
  else                { status='high';     label='Obese (Class III)'; }

  var dots = { low:'▼', optimal:'●', elevated:'▲', high:'▲' };
  badgeEl.innerHTML = '<span class="rbadge rb-'+status+'">'+dots[status]+' '+label+'</span>';
  card.classList.add('s-' + status);

  var minW = Math.ceil((18.5 * hIn * hIn) / 703);
  var maxW = Math.floor((24.9 * hIn * hIn) / 703);
  var note = (bmi >= 18.5 && bmi < 25) ? 'Within healthy weight range' : 'Healthy range for your height: ' + minW + '–' + maxW + ' lbs';

  function pct(b){ return Math.min(100, Math.max(0, ((b - 10) / 35) * 100)); }
  detail.innerHTML =
    '<div class="bmi-bar-wrap">'+
      '<div class="bmi-track"><div class="bmi-marker" style="left:'+pct(bmi)+'%"></div></div>'+
      '<div class="bmi-bar-labels">'+
        '<span class="bmi-bar-lbl">Underweight</span>'+
        '<span class="bmi-bar-lbl">Healthy</span>'+
        '<span class="bmi-bar-lbl">Overweight</span>'+
        '<span class="bmi-bar-lbl">Obese</span>'+
      '</div>'+
    '</div>'+
    '<div class="bmi-note">'+note+'</div>';

  sourceEl.textContent = 'CDC / NIH-NHLBI Adult BMI Classification · Screening tool only';
}

// ─────────────────────────────────────
// HISTORY
// ─────────────────────────────────────
function refreshHistory(){
  var readings = getReadings();
  var list = document.getElementById('history-list');
  list.innerHTML = '';
  if(!readings.length){
    list.innerHTML = '<div class="hist-empty"><div class="hist-empty-icon">&#128203;</div><p class="hist-empty-txt">No readings yet.<br>Tap Log Reading on the dashboard.</p></div>';
    return;
  }
  readings.slice().reverse().forEach(function(r){
    var d  = new Date(r.ts);
    var ds = d.toLocaleDateString([], {weekday:'short',month:'short',day:'numeric'}) + ' · ' + d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    var el = document.createElement('div');
    el.className = 'hist-item';
    el.innerHTML =
      '<div class="hist-date">' + ds + '</div>'+
      '<div class="hist-vals">'+
        '<div><div class="hist-val-lbl">Heart Rate</div><div class="hist-val-num">'+(r.hr||'—')+'<span class="hist-val-unit"> bpm</span></div></div>'+
        '<div><div class="hist-val-lbl">Blood Pressure</div><div class="hist-val-num">'+(r.sys?(r.sys+'/'+(r.dia||'—')):'—')+'<span class="hist-val-unit"> mmHg</span></div></div>'+
        '<div><div class="hist-val-lbl">Weight</div><div class="hist-val-num">'+(r.wt?parseFloat(r.wt).toFixed(1):'—')+'<span class="hist-val-unit"> lbs</span></div></div>'+
      '</div>';
    list.appendChild(el);
  });
}

// ─────────────────────────────────────
// TRENDS
// ─────────────────────────────────────
function refreshTrends(){
  var readings = getReadings();

  function drawChart(svgId, lblId, vals, color){
    var svg = document.getElementById(svgId);
    var lbl = document.getElementById(lblId);
    svg.innerHTML = ''; lbl.innerHTML = '';
    if(vals.length < 2){
      svg.innerHTML = '<text x="150" y="44" text-anchor="middle" font-family="DM Mono,monospace" font-size="11" fill="#555C68" letter-spacing="2">NOT ENOUGH DATA</text>';
      return;
    }
    var vs = vals.map(function(v){ return v.val; });
    var mn = Math.min.apply(null, vs), mx = Math.max.apply(null, vs), rng = mx - mn || 1;
    var pts = vals.map(function(v,i){
      var x = (i / (vals.length-1)) * 298 + 1;
      var y = 74 - ((v.val - mn) / rng) * 68 + 1;
      return x + ',' + y;
    });
    // area fill
    var aPath = 'M' + pts[0] + ' ' + pts.slice(1).map(function(p){ return 'L'+p; }).join(' ') + ' L299,78 L1,78 Z';
    var area = document.createElementNS('http://www.w3.org/2000/svg','path');
    area.setAttribute('d', aPath);
    area.setAttribute('fill', color === '#2ECC71' ? 'rgba(46,204,113,0.08)' : 'rgba(30,136,229,0.08)');
    svg.appendChild(area);
    // line
    var line = document.createElementNS('http://www.w3.org/2000/svg','polyline');
    line.setAttribute('points', pts.join(' '));
    line.setAttribute('fill','none');
    line.setAttribute('stroke', color);
    line.setAttribute('stroke-width','2');
    line.setAttribute('stroke-linecap','round');
    line.setAttribute('stroke-linejoin','round');
    svg.appendChild(line);
    // dots
    vals.forEach(function(v, i){
      var x = (i / (vals.length-1)) * 298 + 1;
      var y = 74 - ((v.val - mn) / rng) * 68 + 1;
      var c = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx', x); c.setAttribute('cy', y); c.setAttribute('r','3');
      c.setAttribute('fill', color); c.setAttribute('stroke','#0E1014'); c.setAttribute('stroke-width','1.5');
      svg.appendChild(c);
    });
    // labels
    var step = Math.ceil(vals.length / 5);
    vals.forEach(function(v, i){
      if(i % step === 0 || i === vals.length-1){
        var sp = document.createElement('span');
        sp.className = 'chart-lbl';
        sp.textContent = new Date(v.ts).toLocaleDateString([],{month:'numeric',day:'numeric'});
        lbl.appendChild(sp);
      }
    });
  }

  function setHeader(valId, chgId, vals, unit){
    if(!vals.length) return;
    document.getElementById(valId).textContent = vals[vals.length-1].val.toFixed(1) + ' ' + unit;
    if(vals.length > 1){
      var diff = vals[vals.length-1].val - vals[0].val;
      var el = document.getElementById(chgId);
      if(Math.abs(diff) < 0.5){ el.textContent='→ Stable'; el.className='trend-chg tc-flat'; }
      else if(diff > 0){ el.textContent='↑ +'+diff.toFixed(1); el.className='trend-chg tc-up'; }
      else { el.textContent='↓ '+diff.toFixed(1); el.className='trend-chg tc-dn'; }
    }
  }

  var hrV  = readings.filter(function(r){ return r.hr; }).map(function(r){ return {val:parseFloat(r.hr),ts:r.ts}; });
  var bpV  = readings.filter(function(r){ return r.sys; }).map(function(r){ return {val:parseFloat(r.sys),ts:r.ts}; });
  var wtV  = readings.filter(function(r){ return r.wt; }).map(function(r){ return {val:parseFloat(r.wt),ts:r.ts}; });

  drawChart('ch-hr','cl-hr', hrV, '#1E88E5');
  drawChart('ch-bp','cl-bp', bpV, '#1E88E5');
  drawChart('ch-wt','cl-wt', wtV, '#2ECC71');
  setHeader('tv-hr','tc-hr', hrV, 'bpm');
  setHeader('tv-bp','tc-bp', bpV, 'mmHg');
  setHeader('tv-wt','tc-wt', wtV, 'lbs');
}

// ─────────────────────────────────────
// PROFILE
// ─────────────────────────────────────
function refreshProfile(){
  var prefs    = getPrefs();
  var readings = getReadings();
  var initials = 'HH';
  if(prefs.name){
    var pts = prefs.name.split(' ');
    initials = pts.map(function(p){ return p[0]||''; }).join('').slice(0,2).toUpperCase();
  }
  document.getElementById('prof-avatar-big').textContent = initials;
  document.getElementById('prof-name-el').textContent    = prefs.name || 'Your Name';
  document.getElementById('prof-user-el').textContent    = currentUser ? currentUser.username : '—';
  document.getElementById('disp-name').textContent       = prefs.name   || 'Not set';
  document.getElementById('disp-age').textContent        = prefs.age    ? prefs.age + ' years' : 'Not set';
  document.getElementById('disp-height').textContent     = prefs.height || 'Not set';
  document.getElementById('disp-count').textContent      = readings.length + ' reading' + (readings.length !== 1 ? 's' : '');
  var tog = document.getElementById('tog-reminders');
  if(prefs.reminders) tog.classList.add('on'); else tog.classList.remove('on');
}

var editingField = '';
function editField(key){
  editingField = key;
  var prefs = getPrefs();
  var cfg = {
    name:   { title:'Full Name',  sub:'Your full name',                  lbl:'Name',   hint:'',                        val: prefs.name   || '' },
    age:    { title:'Age',        sub:'Your age in years',               lbl:'Age',    hint:'years',                   val: prefs.age    || '' },
    height: { title:'Height',     sub:"Accepts: 5'11\", 71\", or 180cm", lbl:'Height', hint:"e.g. 5'11\" or 71in or 180cm", val: prefs.height || '' }
  };
  var c = cfg[key];
  document.getElementById('edit-title').textContent = 'Edit ' + c.title;
  document.getElementById('edit-sub').textContent   = c.sub;
  document.getElementById('edit-lbl').textContent   = c.lbl;
  document.getElementById('edit-hint').textContent  = c.hint;
  document.getElementById('edit-input').value       = c.val;
  document.getElementById('edit-modal').classList.add('open');
  setTimeout(function(){ document.getElementById('edit-input').focus(); }, 80);
}

function saveEdit(){
  var val   = document.getElementById('edit-input').value.trim();
  var prefs = getPrefs();
  prefs[editingField] = val;
  savePrefs(prefs);
  closeModal('edit-modal');
  refreshProfile();
  if(editingField === 'name' || editingField === 'height') refreshHome();
  showToast('✓ ' + editingField.charAt(0).toUpperCase() + editingField.slice(1) + ' updated');
}

function togglePref(key){
  var prefs = getPrefs();
  prefs[key] = !prefs[key];
  savePrefs(prefs);
  refreshProfile();
}

function clearData(){
  if(confirm('Delete ALL readings? This cannot be undone.')){
    saveReadings([]);
    refreshProfile();
    showToast('✓ All readings cleared');
  }
}

// ─────────────────────────────────────
// LOG MODAL
// ─────────────────────────────────────
function openLogModal(){
  var now = new Date();
  document.getElementById('log-modal-date').textContent = now.toLocaleDateString([], {weekday:'long', month:'long', day:'numeric'});
  document.getElementById('log-modal').classList.add('open');
  setTimeout(function(){ document.getElementById('in-hr').focus(); }, 80);
}

function saveReading(){
  var hr  = document.getElementById('in-hr').value.trim();
  var sys = document.getElementById('in-sys').value.trim();
  var dia = document.getElementById('in-dia').value.trim();
  var wt  = document.getElementById('in-wt').value.trim();
  if(!hr && !sys && !wt){ alert('Enter at least one value.'); return; }
  var readings = getReadings();
  readings.push({ ts:Date.now(), hr:hr||null, sys:sys||null, dia:dia||null, wt:wt||null });
  saveReadings(readings);
  ['in-hr','in-sys','in-dia','in-wt'].forEach(function(id){ document.getElementById(id).value = ''; });
  closeModal('log-modal');
  showToast('✓ Reading saved');
  refreshHome();
}

// ─────────────────────────────────────
// MODALS
// ─────────────────────────────────────
function closeModal(id){ document.getElementById(id).classList.remove('open'); }
function bgClose(e, id){ if(e.target === document.getElementById(id)) closeModal(id); }

// ─────────────────────────────────────
// TOAST
// ─────────────────────────────────────
function showToast(msg){
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.style.display = 'block';
  setTimeout(function(){ t.style.display = 'none'; }, 2500);
}

// ─────────────────────────────────────
// PDF EXPORT
// ─────────────────────────────────────
function exportPDF(){
  var prefs = getPrefs();
  var now   = new Date();
  document.body.setAttribute('data-print-date', now.toLocaleDateString([], {year:'numeric',month:'long',day:'numeric'}));
  var pn = document.getElementById('print-name-el');
  var pd = document.getElementById('print-date-el');
  if(pn) pn.textContent = prefs.name || 'Health Report';
  if(pd) pd.textContent = 'Generated: ' + now.toLocaleDateString([], {weekday:'long',year:'numeric',month:'long',day:'numeric'});
  showScreen('home');
  setTimeout(function(){ window.print(); }, 150);
}

// ─────────────────────────────────────
// INIT
// ─────────────────────────────────────
window.addEventListener('DOMContentLoaded', function(){
  var sessionUser = getSession();
  if(sessionUser){
    var users = getUsers();
    for(var i=0; i<users.length; i++){
      if(users[i].username === sessionUser){
        currentUser = users[i];
        showScreen('home');
        return;
      }
    }
  }
  showScreen('login');
});
</script>
</body>
</html>
